select
  pr.scode ApplicationUniqueId,
  t.scode TenantID,
  p.scode PropertyID,
  p.saddr1 PropertyName,
  u.scode Unit#,
  t.dtleasefrom LeaseStartDate,
  t.dtleaseto LeaseEndDate,
  ts.status TenantStatus,
  t.srent RentAmount,
  t.dtmovein MoveInDate,
  t.dtmoveout MoveDateOut,
  tr.stotalamount OpenDepositBalance,
  0 ClosedDepositBalance,
  0 UnpaidRentAtMoveOut,
  0 OtherUnpaidAmtAtMoveOut,
  0 AmountPaidByTenantAtMoveOut
from
  property p
  inner join unit u on u.hproperty = p.hmy
  inner join prospect pr on pr.hunit = u.hmy
  and pr.hproperty = p.hmy
  inner join tenant t on t.hmyperson = pr.htenant
  inner join tenstatus ts on ts.istatus = t.istatus
  inner join trans tr on tr.hperson = t.hmyperson
  and tr.hretentionacct = 37
where
  p.ityperes = 1
  and t.istatus in(0, 1, 2, 4, 6, 7, 9)
  
-------------------------------------------------
Part-2


select
  pr.scode ApplicationUniqueId,
  t.scode TenantID,
  p.scode PropertyID,
  p.saddr1 PropertyName,
  u.scode Unit#,
  t.dtleasefrom LeaseStartDate,
  t.dtleaseto LeaseEndDate,
  ts.status TenantStatus,
  t.srent RentAmount,
  t.dtmovein MoveInDate,
  t.dtmoveout MoveDateOut,
  (case when tr.hretentionacct=37 then tr.stotalamount else '0' end) OpenDepositBalance,
 -- (
   -- case when (t.istatus=1 and tr.bopen=-1) then sum(stotalamount-samountpaid) else '0' end
  --) ClosedDepositBalance,
  (case when t.istatus=1 then (case when tr.bopen=-1 then sum(stotalamount-samountpaid) else '0' end) else '0' end) ClosedDepositBalance,
  (case when t.istatus=1 then (case when tr.bopen=-1 then (case when tr.hretentionacct in (52,75) then sum(stotalamount) else '0' end) else '0' end ) else '0' end)
   UnpaidRentAtMoveOut,
  0 OtherUnpaidAmtAtMoveOut,
  0 AmountPaidByTenantAtMoveOut
from
  property p
  inner join unit u on u.hproperty = p.hmy
  inner join prospect pr on pr.hunit = u.hmy
  and pr.hproperty = p.hmy
  inner join tenant t on t.hmyperson = pr.htenant
  inner join tenstatus ts on ts.istatus = t.istatus
  left join trans tr on tr.hperson = t.hmyperson
  --and tr.hretentionacct = 37
where
  p.ityperes = 1
  --and t.istatus in(0, 1, 2, 4, 6, 7, 9)
  and t.scode='t0004002'
group by p.scode,u.scode,pr.scode,
t.scode,
p.saddr1,
t.dtmovein,
t.dtleasefrom,
t.dtleaseto,
t.dtmoveout,
ts.status,
t.srent,
tr.stotalamount,
t.istatus,
tr.bopen,
tr.hretentionacct

-------------------------------------------------
Part - 3

select
  pr.scode ApplicationUniqueId,
  t.scode TenantID,
  p.scode PropertyID,
  p.saddr1 PropertyName,
  u.scode Unit#,
  t.dtleasefrom LeaseStartDate,
  t.dtleaseto LeaseEndDate,
  ts.status TenantStatus,
  t.srent RentAmount,
  t.dtmovein MoveInDate,
  t.dtmoveout MoveDateOut,
  (case when tr.hretentionacct=37 then tr.stotalamount else '0' end) OpenDepositBalance,
  (case when t.istatus=1 then (case when tr.bopen=-1 then sum(stotalamount-samountpaid) else '0' end) else '0' end) ClosedDepositBalance,
  (case when t.istatus=1 then (case when tr.bopen=-1 then (case when tr.hretentionacct in (52,75) then sum(stotalamount) else '0' end) else '0' end ) else '0' end) UnpaidRentAtMoveOut,
  (case when t.istatus=1 then (case when tr.bopen=-1 then (case when tr.hretentionacct not in (52,75) then sum(stotalamount) else '0' end) else '0' end ) else '0' end) OtherUnpaidAmtAtMoveOut,
  0 AmountPaidByTenantAtMoveOut
from
  property p
  inner join unit u on u.hproperty = p.hmy
  inner join prospect pr on pr.hunit = u.hmy
  and pr.hproperty = p.hmy
  inner join tenant t on t.hmyperson = pr.htenant
  inner join tenstatus ts on ts.istatus = t.istatus
  left join trans tr on tr.hperson = t.hmyperson
  --and tr.hretentionacct = 37
where
  p.ityperes = 1
  --and t.istatus in(0, 1, 2, 4, 6, 7, 9)
  and t.scode='t0004002'
group by p.scode,u.scode,pr.scode,
t.scode,
p.saddr1,
t.dtmovein,
t.dtleasefrom,
t.dtleaseto,
t.dtmoveout,
ts.status,
t.srent,
tr.stotalamount,
t.istatus,
tr.bopen,
tr.hretentionacct


----------------------------------
select
  pr.scode ApplicationUniqueId,
  t.scode TenantID,
  p.scode PropertyID,
  p.saddr1 PropertyName,
  u.scode Unit#,
  t.dtleasefrom LeaseStartDate,
  t.dtleaseto LeaseEndDate,
  ts.status TenantStatus,
  t.srent RentAmount,
  t.dtmovein MoveInDate,
  t.dtmoveout MoveDateOut,
  OPBal.OPtotal OpenDepositBalance,
  --(case when t.istatus=1 then (case when tr.bopen=-1 then sum(tr.stotalamount-tr.samountpaid) else '0' end) else '0' end) ClosedDepositBalance1,
  --(case when t.istatus=1 then (case when tr.bopen=-1 then (case when tr.hretentionacct in (52,75) then sum(tr.stotalamount-tr.samountpaid) else '0' end) else '0' end ) else '0' end) UnpaidRentAtMoveOut,
  --(case when t.istatus=1 then (case when tr.bopen=-1 then (case when tr.hretentionacct not in (52,75) then sum(tr.stotalamount-tr.samountpaid) else '0' end) else '0' end ) else '0' end) OtherUnpaidAmtAtMoveOut,
  0 AmountPaidByTenantAtMoveOut
from
  property p
  inner join unit u on u.hproperty = p.hmy
  inner join tenant t on t.hproperty = p.hmy and t.hunit=u.hmy
  inner join prospect pr on pr.htenant=t.hmyperson
  left join tenstatus ts on ts.istatus = t.istatus
  left join (select tr.hperson personhmy,sum(tr.stotalamount) OPtotal from trans tr inner join tenant t on t.hmyperson=tr.hperson and tr.hretentionacct=37 group by tr.hperson) OPBal 
  on OPBal.personhmy=t.hmyperson and t.scode='t0004002'

where
  p.ityperes = 1
  --and t.istatus in(0, 1, 2, 4, 6, 7, 9)
  and t.scode='t0004002'
group by p.scode,
u.scode,
pr.scode,
t.scode,
p.saddr1,
t.dtmovein,
t.dtleasefrom,
t.dtleaseto,
t.dtmoveout,
ts.status,
t.srent
--tr.stotalamount,
--OPBal.OPtotal,
--t.istatus,
--tr.bopen,
--tr.hretentionacct,
--t.bmovedout



----------------------select
  pr.scode ApplicationUniqueId,
  t.scode TenantID,
  p.scode PropertyID,
  p.saddr1 PropertyName,
  u.scode Unit#,
  t.dtleasefrom LeaseStartDate,
  t.dtleaseto LeaseEndDate,
  ts.status TenantStatus,
  t.srent RentAmount,
  t.dtmovein MoveInDate,
  t.dtmoveout MoveDateOut,
  OPBal.OPtotal OpenDepositBalance,
  COLBal.coltotal ClosedDepositBalance1,
  UnpaidRentTotal.unpaidrent UnpaidRentAtMoveOut,
  UnpaidOtherTotal.unpaidotheramt OtherUnpaidAmtAtMoveOut,
  0 AmountPaidByTenantAtMoveOut
from
  property p
  inner join unit u on u.hproperty = p.hmy
  inner join tenant t on t.hproperty = p.hmy and t.hunit=u.hmy
  inner join prospect pr on pr.htenant=t.hmyperson
  left join tenstatus ts on ts.istatus = t.istatus
  left join (select tr.hperson personhmy,sum(tr.stotalamount) OPtotal from trans tr inner join tenant t on t.hmyperson=tr.hperson and tr.hretentionacct=37 and tr.stotalamount>0 group by tr.hperson) OPBal 
  on OPBal.personhmy=t.hmyperson
  left join (select tr.hperson personhmy, sum(tr.stotalamount-tr.samountpaid) coltotal from tenant t inner join trans tr on tr.hperson=t.hmyperson and tr.bopen=-1 and t.istatus=1 and t.bmovedout=-1 and tr.itype=7 group by tr.hperson) COLBal
  on COLBal.personhmy=t.hmyperson
  left join (select tr.hperson personhmy, sum(tr.stotalamount-tr.samountpaid) unpaidrent from tenant t inner join trans tr on tr.hperson=t.hmyperson and tr.bopen=-1 and t.istatus=1 and tr.hretentionacct in (52,75) group by tr.hperson) UnpaidRentTotal
  on UnpaidRentTotal.personhmy=t.hmyperson
  left join (select tr.hperson personhmy, sum(tr.stotalamount-tr.samountpaid) unpaidotheramt from tenant t inner join trans tr on tr.hperson=t.hmyperson and tr.bopen=-1 and t.istatus=1 and tr.hretentionacct not in (52,75) group by tr.hperson) UnpaidOtherTotal
  on UnpaidOtherTotal.personhmy=t.hmyperson
  left join (select t.hmyperson personhmy, sum(tr.stotalamount) ReceiptAfterDA from tenant t inner join tenant_history th 
             on th.htent=t.hmyperson and th.sevent='Deposit Accounting' and t.bmovedout=-1 and t.istatus=1
            inner join trans tr on tr.hperson=t.hmyperson and tr.itype=6 and tr.sdatecreated > th.dtoccurred group by t.hmyperson)
             
where
  p.ityperes = 1
  --and t.istatus in(0, 1, 2, 4, 6, 7, 9)
  and t.scode in ('t0012235','t0004002')
group by p.scode,
u.scode,
pr.scode,
t.scode,
p.saddr1,
t.dtmovein,
t.dtleasefrom,
t.dtleaseto,
t.dtmoveout,
ts.status,
t.srent,
COLBal.coltotal,
OPBal.OPtotal,
UnpaidRentTotal.unpaidrent,
UnpaidOtherTotal.unpaidotheramt,
t.istatus
--tr.hretentionacct,
--t.bmovedout
